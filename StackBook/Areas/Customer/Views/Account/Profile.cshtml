@model StackBook.Models.User;
@{
    ViewData["Title"] = "User Profile";
    ViewData["ActivePage"] = "Profile";
}

@{
    Layout = "_Layout";
}

<head>
    <link rel="stylesheet" href="~/css/profile.css" />
</head>


<div class="container py-4">
    <div class="row">
        <!-- Sidebar Section -->
        @await Html.PartialAsync("_SideBar", Model)
        <div class="col-md-9">
            <div class="profile-container">
                <!-- Phần header và thông tin cơ bản -->
                <div class="profile-header">
                    <!-- Avatar now wrapped in a form with auto-submit -->
                    <form id="avatarForm" method="post" asp-action="UpdateAvatar" asp-controller="Account" enctype="multipart/form-data" class="avatar-form">
                        <input type="hidden" name="userId" value="@Model.UserId" />
                        <input hidden type="file" id="avatarInput" name="image" accept="image/*" onchange="this.form.submit()" />
                    </form>

                    <label for="avatarInput" class="avatar-container">
                        <img src="@(string.IsNullOrEmpty(Model.AvatarUrl) ? "https://www.gravatar.com/avatar/default?s=200&d=mp" : Model.AvatarUrl)" alt="Profile Avatar">
                        <div class="avatar-upload">Change Photo</div>
                    </label>
                    <h2>My Profile</h2>
                </div>

                <div class="profile-info">
                    <p><strong>Full Name:</strong> @Model.FullName</p>
                    <p><strong>Email:</strong> @Model.Email</p>
                </div>

                <div class="profile-section">
                    <h3>Update Full Name</h3>
                    <form method="post" asp-action="UpdateUserName" asp-controller="Account">
                        <input type="hidden" name="userId" value="@Model.UserId" />
                        <div class="form-group">
                            <label for="fullName">Full Name</label>
                            <input type="text" id="FullName" name="username" value="@Model.FullName" required />
                        </div>
                        <button type="submit">Update Name</button>
                    </form>
                </div>

                <!-- Form: Cập nhật Email -->
                <div class="profile-section">
                    <h3>Update Email</h3>
                    <form method="post" asp-action="UpdateEmail" asp-controller="Account">
                        <input type="hidden" name="userId" value="@Model.UserId" />
                        <div class="form-group">
                            <label for="email">Email</label>
                            <input type="email" id="email" name="email" value="@Model.Email" required />
                        </div>
                        <button type="submit">Update Email</button>
                    </form>
                </div>

                <!-- Form: Thay đổi mật khẩu -->
                <div class="profile-section">
                    <h3>Change Password</h3>
                    <form method="post" asp-action="ChangePassword" asp-controller="Account">
                        <input type="hidden" name="userId" value="@Model.UserId" />
                        <div class="form-group">
                            <label for="currentPassword">Current Password</label>
                            <input type="password" id="currentPassword" name="currentPassword" required />
                        </div>
                        <div class="form-group">
                            <label for="newPassword">New Password</label>
                            <input type="password" id="newPassword" name="newPassword" required />
                        </div>
                        <div class="form-group">
                            <label for="confirmPassword">Confirm New Password</label>
                            <input type="password" id="confirmPassword" name="confirmPassword" required />
                        </div>
                        <button type="submit">Change Password</button>
                    </form>
                </div>

                <!-- Form 4: Đăng xuất -->
                <div class="profile-section">
                    <h3>Account Actions</h3>
                    <form method="get" asp-area="Site" asp-controller="Account" asp-action="SignOut">
                        <button type="submit" class="logout-btn">Logout</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>